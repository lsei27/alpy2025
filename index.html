 <!DOCTYPE html>
 <html lang="cs">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
-    <title>Alpská cesta: Ramsau, Hallstatt, Berchtesgaden, Salcburk</title>
+    <title>Marketingový dashboard</title>
+    <link rel="preconnect" href="https://fonts.googleapis.com">
+    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
+    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
+    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js" defer></script>
+    <script src="https://cdn.jsdelivr.net/npm/luxon@3.5.0/build/global/luxon.min.js" defer></script>
+    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.4.0/dist/chartjs-adapter-luxon.umd.min.js" defer></script>
+    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
     <style>
-        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f8f9fa; }
-        header { text-align: center; margin-bottom: 40px; }
-        h1 { color: #2c3e50; margin-bottom: 10px; }
-        h2 { color: #2980b9; border-bottom: 2px solid #2980b9; padding-bottom: 5px; margin-top: 40px; }
-        .day { background: #fff; border-radius: 10px; padding: 20px; margin-bottom: 30px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
-        .place { margin: 20px 0; }
-        .place h3 { color: #e74c3c; }
-        .place img { width: 100%; border-radius: 8px; margin: 10px 0; }
-        .activities { margin-left: 20px; }
-        .activities li { margin-bottom: 8px; }
-        footer { text-align: center; margin-top: 40px; color: #7f8c8d; }
+        :root {
+            color-scheme: light;
+            --bg: #f2f4f8;
+            --surface: #ffffff;
+            --text: #1a1c1e;
+            --text-muted: #5f6b7a;
+            --primary: #2563eb;
+            --primary-soft: rgba(37, 99, 235, 0.12);
+            --border: #e2e8f0;
+            --success: #16a34a;
+            --danger: #dc2626;
+            --warning: #f59e0b;
+        }
+
+        * {
+            box-sizing: border-box;
+        }
+
+        body {
+            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
+            margin: 0;
+            background: var(--bg);
+            color: var(--text);
+        }
+
+        header {
+            padding: 32px clamp(16px, 4vw, 48px) 24px;
+            background: var(--surface);
+            border-bottom: 1px solid var(--border);
+            box-shadow: 0 10px 40px rgba(15, 23, 42, 0.06);
+            position: sticky;
+            top: 0;
+            z-index: 10;
+        }
+
+        header h1 {
+            margin: 0;
+            font-size: clamp(28px, 4vw, 40px);
+            font-weight: 700;
+            letter-spacing: -0.02em;
+        }
+
+        header p {
+            margin: 8px 0 0;
+            color: var(--text-muted);
+            max-width: 720px;
+        }
+
+        main {
+            padding: 24px clamp(16px, 4vw, 48px) 80px;
+            display: grid;
+            gap: 24px;
+        }
+
+        .panel {
+            background: var(--surface);
+            border: 1px solid var(--border);
+            border-radius: 20px;
+            padding: clamp(18px, 3vw, 28px);
+            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
+        }
+
+        .flex {
+            display: flex;
+            flex-wrap: wrap;
+            gap: 16px;
+            align-items: flex-end;
+        }
+
+        label {
+            font-size: 14px;
+            font-weight: 600;
+            color: var(--text-muted);
+        }
+
+        .helper-text {
+            font-size: 12px;
+            color: var(--text-muted);
+            margin-top: 6px;
+            max-width: 480px;
+            line-height: 1.45;
+        }
+
+        input, select, button {
+            font: inherit;
+            padding: 10px 14px;
+            border-radius: 12px;
+            border: 1px solid var(--border);
+            background: #fff;
+            color: inherit;
+        }
+
+        input:focus, select:focus, button:focus {
+            outline: 2px solid var(--primary);
+            outline-offset: 2px;
+        }
+
+        button.primary {
+            background: var(--primary);
+            color: #fff;
+            border-color: var(--primary);
+            cursor: pointer;
+            transition: background 0.2s ease, transform 0.2s ease;
+        }
+
+        button.primary:hover {
+            background: #1d4ed8;
+            transform: translateY(-1px);
+        }
+
+        button.ghost {
+            background: transparent;
+            color: var(--text-muted);
+        }
+
+        .status {
+            padding: 12px 16px;
+            border-radius: 14px;
+            background: var(--primary-soft);
+            color: var(--primary);
+            display: flex;
+            align-items: center;
+            gap: 12px;
+            margin-top: 16px;
+        }
+
+        .status svg {
+            flex-shrink: 0;
+        }
+
+        .grid {
+            display: grid;
+            gap: 20px;
+        }
+
+        .grid.kpi {
+            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
+        }
+
+        .kpi-card {
+            padding: 20px;
+            border-radius: 16px;
+            border: 1px solid var(--border);
+            background: radial-gradient(circle at top left, rgba(37,99,235,0.08), transparent 60%), #fff;
+            display: grid;
+            gap: 12px;
+        }
+
+        .kpi-card h3 {
+            margin: 0;
+            font-size: 16px;
+            color: var(--text-muted);
+            font-weight: 600;
+        }
+
+        .kpi-card .value {
+            font-size: 30px;
+            font-weight: 700;
+            letter-spacing: -0.02em;
+        }
+
+        .kpi-card .delta {
+            font-size: 14px;
+            font-weight: 600;
+        }
+
+        .delta.up { color: var(--success); }
+        .delta.down { color: var(--danger); }
+
+        .charts {
+            display: grid;
+            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
+            gap: 24px;
+        }
+
+        canvas {
+            width: 100% !important;
+            max-height: 320px;
+        }
+
+        table {
+            width: 100%;
+            border-collapse: collapse;
+        }
+
+        thead th {
+            text-align: left;
+            font-size: 13px;
+            text-transform: uppercase;
+            letter-spacing: 0.04em;
+            color: var(--text-muted);
+            padding-bottom: 12px;
+        }
+
+        tbody td {
+            padding: 12px 0;
+            border-top: 1px solid var(--border);
+            font-size: 15px;
+        }
+
+        tbody tr:hover {
+            background: rgba(148, 163, 184, 0.12);
+        }
+
+        .iframe-wrapper {
+            border-radius: 16px;
+            overflow: hidden;
+            border: 1px solid var(--border);
+            min-height: 320px;
+        }
+
+        iframe {
+            width: 100%;
+            height: 400px;
+            border: 0;
+        }
+
+        @media (max-width: 768px) {
+            header {
+                position: static;
+            }
+
+            .charts {
+                grid-template-columns: 1fr;
+            }
+        }
     </style>
 </head>
 <body>
     <header>
-        <h1>Alpská cesta: Ramsau, Hallstatt, Berchtesgaden, Salcburk</h1>
-        <p>5 dní plných horských túr, jezer, historie a nezapomenutelných zážitků</p>
+        <h1>Marketingový dashboard</h1>
+        <p>Centralizovaný přehled výkonu kampaní z Excelového reportu. Dashboard automaticky zpracuje soubor ze SharePointu nebo vlastní nahraný soubor.</p>
     </header>
 
-    <div class="day">
-        <h2>1. den: Příjezd a okolí Ramsau am Dachstein</h2>
-        <div class="place">
-            <h3>Ramsau am Dachstein</h3>
-            <img src="https://www.skiamade.com/media-import-nw/website-relaunch-fotos/sommer/regionen/schladming-dachstein/image-thumb__4049195__hero-full-height/2020-ramsau-sommer-wandern.webp" alt="Ramsau am Dachstein">
-            <div class="activities">
-                <ul>
-                    <li>Příjezd z Prahy</li>
-                    <li>Odpolední procházka k jezeru Spiegelsee</li>
-                    <li>Procházka náhorní plošinou Ramsau</li>
-                </ul>
+    <main>
+        <section class="panel">
+            <h2>Zdroj dat</h2>
+            <div class="flex">
+                <div>
+                    <label for="excelFile">Nahrát vlastní Excel</label><br>
+                    <input type="file" id="excelFile" accept=".xlsx,.xls">
+                </div>
+                <div>
+                    <label for="remoteUrl">Veřejný odkaz na Excel (např. GitHub RAW)</label><br>
+                    <input type="url" id="remoteUrl" placeholder="https://.../soubor.xlsx">
+                </div>
+                <div>
+                    <label for="sheetName">List ve sešitu</label><br>
+                    <input type="text" id="sheetName" placeholder="(volitelné – např. Marketing)" />
+                </div>
+                <button class="primary" id="reloadBtn">Načíst z odkazu</button>
+                <button class="ghost" id="resetFiltersBtn">Vymazat filtry</button>
             </div>
-        </div>
-    </div>
-
-    <div class="day">
-        <h2>2. den: Jezera Gosauseen a horská túra</h2>
-        <div class="place">
-            <h3>Jezera Gosauseen</h3>
-            <img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=800&q=80" alt="Gosausee a Dachstein">
-            <div class="activities">
-                <ul>
-                    <li>Okružní trasa kolem Vorderer Gosausee</li>
-                    <li>Pokračování k jezerům Gosaulacke a Hinterer Gosausee</li>
-                    <li>Možnost lanovky na vyhlídku</li>
-                </ul>
+            <p class="helper-text">
+                Pokud je soubor hostovaný na GitHubu, použijte tlačítko <strong>Download raw file</strong> a zkopírujte jeho adresu.
+                Sdílené soubory ze SharePointu často vyžadují přihlášení a nemusí být prohlížečem dostupné kvůli CORS.
+            </p>
+            <div class="status" id="statusMessage" role="status" aria-live="polite">
+                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
+                    <path d="M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 10C18.3333 5.39763 14.6024 1.66667 10 1.66667C5.39763 1.66667 1.66667 5.39763 1.66667 10C1.66667 14.6024 5.39763 18.3333 10 18.3333Z" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
+                    <path d="M10 6.66667V10" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
+                    <path d="M10 13.3333H10.0083" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
+                </svg>
+                <span>Čekám na načtení dat…</span>
             </div>
-        </div>
-    </div>
-
-    <div class="day">
-        <h2>3. den: Soutěska Silberkarklamm a výstup k jezeru Silberkarsee</h2>
-        <div class="place">
-            <h3>Soutěska Silberkarklamm</h3>
-            <img src="https://www.ceskypenzionvalpach.cz/upload/ckeditor/images/IMG_2666(1).JPEG" alt="Soutěska Silberkarklamm">
-            <div class="activities">
-                <ul>
-                    <li>Procházka soutěskou Silberkarklamm</li>
-                    <li>Výstup k chatě Silberkarhütte a jezeru Silberkarsee</li>
-                </ul>
+        </section>
+
+        <section class="panel">
+            <h2>Filtrace</h2>
+            <div class="flex" id="filters">
+                <div>
+                    <label for="fromDate">Od data</label><br>
+                    <input type="date" id="fromDate">
+                </div>
+                <div>
+                    <label for="toDate">Do data</label><br>
+                    <input type="date" id="toDate">
+                </div>
+                <div>
+                    <label for="channelFilter">Marketingový kanál</label><br>
+                    <select id="channelFilter"></select>
+                </div>
+                <div>
+                    <label for="campaignFilter">Kampaň</label><br>
+                    <select id="campaignFilter"></select>
+                </div>
             </div>
-        </div>
-    </div>
-
-    <div class="day">
-        <h2>4. den: Hallstatt a okolí</h2>
-        <div class="place">
-            <h3>Hallstatt</h3>
-            <img src="https://upload.wikimedia.org/wikipedia/commons/5/54/1_hallstatt_austria.jpg" alt="Hallstatt, výhled na jezero">
-            <div class="activities">
-                <ul>
-                    <li>Procházka centrem Hallstattu, Marktplatz, kostnice</li>
-                    <li>Prohlídka solného dolu Salzwelten</li>
-                    <li>Procházka kolem Hallstätter See</li>
-                    <li>Výlet do údolí Echerntal</li>
-                </ul>
+        </section>
+
+        <section class="grid kpi" id="kpiGrid"></section>
+
+        <section class="panel">
+            <h2>Výkonnost kampaní v čase</h2>
+            <div class="charts">
+                <div>
+                    <canvas id="trendChart"></canvas>
+                </div>
+                <div>
+                    <canvas id="channelChart"></canvas>
+                </div>
+                <div>
+                    <canvas id="funnelChart"></canvas>
+                </div>
             </div>
-        </div>
-    </div>
-
-    <div class="day">
-        <h2>5. den: Berchtesgaden, Orlí hnízdo a Salcburk</h2>
-        <div class="place">
-            <h3>Berchtesgaden</h3>
-            <img src="https://vcdn.bergfex.at/images/resized/e8/7b8d82be8eb888e8_66f055c2cbfd3963@2x.jpg" alt="Berchtesgaden panorama">
-            <div class="activities">
-                <ul>
-                    <li>Procházka městem Berchtesgaden</li>
-                    <li>Výlet k jezeru Hintersee nebo soutěsce Almbachklamm</li>
-                    <li>Výjezd k Orlímu hnízdu (Kehlsteinhaus)</li>
-                </ul>
+        </section>
+
+        <section class="panel">
+            <h2>Top kampaně podle ROI</h2>
+            <div class="table-wrapper">
+                <table>
+                    <thead>
+                        <tr>
+                            <th>Kampaň</th>
+                            <th>Kanál</th>
+                            <th>Tržby</th>
+                            <th>Náklady</th>
+                            <th>ROI</th>
+                            <th>Konverze</th>
+                        </tr>
+                    </thead>
+                    <tbody id="campaignTable"></tbody>
+                </table>
             </div>
-        </div>
-        <div class="place">
-            <h3>Orlí hnízdo (Kehlsteinhaus)</h3>
-            <img src="https://data.ceskekormidlo.cz/Zajezd/14173/128419.jpeg" alt="Orlí hnízdo (Kehlsteinhaus)">
-        </div>
-        <div class="place">
-            <h3>Salcburk</h3>
-            <img src="https://cdn.salzburgerland.com/cs/wp-content/uploads/2019/05/dom_stieglkeller-1170x658.jpg" alt="Salcburk, historické centrum">
-            <div class="activities">
-                <ul>
-                    <li>Procházka historickým centrem (Altstadt)</li>
-                    <li>Palác Mirabell, pevnost Hohensalzburg, Mozartplatz</li>
-                </ul>
+        </section>
+
+        <section class="panel">
+            <h2>Excelový report (embedded náhled)</h2>
+            <div class="iframe-wrapper">
+                <iframe id="excelEmbed" title="SharePoint Excel" allowfullscreen src="https://incatering.sharepoint.com/_layouts/15/Doc.aspx?sourcedoc={2e7f60ff-49b9-4883-9ac0-4f143b0b2f4b}&action=embedview&wdAllowInteractivity=False&wdHideGridlines=True&wdHideHeaders=True&wdDownloadButton=True&wdInConfigurator=True"></iframe>
             </div>
-        </div>
-    </div>
+        </section>
+    </main>
+
+    <script defer>
+        const DEFAULT_EXCEL_URL = 'https://incatering.sharepoint.com/_layouts/15/download.aspx?SourceUrl=https://incatering.sharepoint.com/_layouts/15/Doc.aspx?sourcedoc={2e7f60ff-49b9-4883-9ac0-4f143b0b2f4b}&file=Marketing.xlsx&action=default';
+
+        const FALLBACK_DATA = [
+            { date: '2025-01-05', channel: 'Facebook Ads', campaign: 'Zimní promo', spend: 18000, revenue: 52000, leads: 120, conversions: 18, clicks: 2100, impressions: 88000 },
+            { date: '2025-01-12', channel: 'Google Ads', campaign: 'Zimní promo', spend: 24000, revenue: 64000, leads: 140, conversions: 22, clicks: 2600, impressions: 94000 },
+            { date: '2025-01-19', channel: 'Newsletter', campaign: 'Leden news', spend: 8000, revenue: 41000, leads: 220, conversions: 30, clicks: 5400, impressions: 56000 },
+            { date: '2025-01-26', channel: 'LinkedIn Ads', campaign: 'B2B akvizice', spend: 12000, revenue: 36000, leads: 75, conversions: 12, clicks: 1700, impressions: 43000 },
+            { date: '2025-02-02', channel: 'SEO', campaign: 'Organický traffic', spend: 6000, revenue: 28500, leads: 90, conversions: 15, clicks: 3200, impressions: 99000 }
+        ];
+
+        const state = {
+            data: [],
+            filtered: [],
+            charts: {},
+            meta: {
+                source: 'Externí odkaz'
+            }
+        };
+
+        const columnMap = {
+            date: ['date', 'datum', 'date ', 'data'],
+            channel: ['channel', 'kanál', 'kanal', 'marketing channel'],
+            campaign: ['campaign', 'kampaň', 'campaign name'],
+            spend: ['spend', 'cost', 'náklady', 'utrata'],
+            revenue: ['revenue', 'tržby', 'obrat', 'sales'],
+            leads: ['leads', 'poptávky', 'leady'],
+            conversions: ['conversions', 'objednávky', 'orders'],
+            clicks: ['clicks', 'prokliky'],
+            impressions: ['impressions', 'zobrazení', 'reach']
+        };
+
+        const formatters = {
+            currency: new Intl.NumberFormat('cs-CZ', { style: 'currency', currency: 'CZK', maximumFractionDigits: 0 }),
+            integer: new Intl.NumberFormat('cs-CZ', { maximumFractionDigits: 0 }),
+            percent: new Intl.NumberFormat('cs-CZ', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })
+        };
+
+        const statusMessage = document.getElementById('statusMessage').querySelector('span');
+
+        document.addEventListener('DOMContentLoaded', () => {
+            bindEvents();
+            hydrateFromFallback();
+            tryLoadFromRemote();
+        });
+
+        function bindEvents() {
+            document.getElementById('excelFile').addEventListener('change', handleFileUpload);
+            document.getElementById('reloadBtn').addEventListener('click', tryLoadFromRemote);
+            document.getElementById('resetFiltersBtn').addEventListener('click', () => {
+                document.getElementById('fromDate').value = '';
+                document.getElementById('toDate').value = '';
+                document.getElementById('channelFilter').value = 'ALL';
+                document.getElementById('campaignFilter').value = 'ALL';
+                applyFilters();
+            });
+            ['fromDate', 'toDate', 'channelFilter', 'campaignFilter'].forEach(id => {
+                document.getElementById(id).addEventListener('change', applyFilters);
+            });
+        }
+
+        async function tryLoadFromRemote() {
+            const remoteInput = document.getElementById('remoteUrl');
+            const targetUrl = remoteInput.value.trim() || DEFAULT_EXCEL_URL;
+            const isDefault = !remoteInput.value.trim();
+            setStatus(isDefault ? 'Načítám data z výchozího odkazu…' : 'Načítám data z poskytnutého odkazu…');
+            const sheetName = document.getElementById('sheetName').value.trim();
+            try {
+                const response = await fetch(targetUrl);
+                if (!response.ok) {
+                    throw new Error('Odpověď serveru: ' + response.status);
+                }
+                const contentType = response.headers.get('content-type') || '';
+                if (!contentType.includes('spreadsheet') && !contentType.includes('application/octet-stream')) {
+                    throw new Error('Očekáván Excel, ale server vrátil typ: ' + contentType);
+                }
+                const buffer = await response.arrayBuffer();
+                const sourceLabel = isDefault ? 'Výchozí odkaz' : targetUrl;
+                processWorkbook(buffer, sheetName || undefined, sourceLabel);
+                setStatus('Data úspěšně načtena z externího odkazu.');
+            } catch (error) {
+                console.warn('Nepodařilo se načíst Excel z odkazu:', error);
+                const hadData = state.data.length > 0;
+                if (!hadData) {
+                    hydrateFromFallback();
+                }
+                setStatus('Nepodařilo se načíst soubor z odkazu. ' + (hadData ? 'Zůstávají dostupná dosavadní data (např. ukázková).' : 'Jsou zobrazena ukázková data. Nahrajte prosím vlastní Excel nebo vložte veřejný GitHub RAW odkaz.'));
+            }
+        }
+
+        function hydrateFromFallback() {
+            if (state.data.length) return;
+            const parsed = FALLBACK_DATA.map(normalizeFallbackRow);
+            state.data = parsed;
+            state.meta.source = 'Ukázková data';
+            populateFilters();
+            applyFilters();
+            setStatus('Zobrazena ukázková data. Nahrajte vlastní Excel nebo vložte veřejný odkaz.');
+        }
+
+        function normalizeFallbackRow(row) {
+            return {
+                date: new Date(row.date),
+                channel: row.channel,
+                campaign: row.campaign,
+                spend: row.spend,
+                revenue: row.revenue,
+                leads: row.leads,
+                conversions: row.conversions,
+                clicks: row.clicks,
+                impressions: row.impressions
+            };
+        }
+
+        function handleFileUpload(event) {
+            const file = event.target.files[0];
+            if (!file) return;
+            setStatus('Zpracovávám nahraný soubor…');
+            const reader = new FileReader();
+            reader.onload = e => {
+                const sheetName = document.getElementById('sheetName').value.trim();
+                processWorkbook(e.target.result, sheetName || undefined, file.name);
+                setStatus(`Data načtena ze souboru ${file.name}.`);
+            };
+            reader.onerror = () => setStatus('Nepodařilo se přečíst vybraný soubor.');
+            reader.readAsArrayBuffer(file);
+        }
+
+        function processWorkbook(arrayBuffer, sheetName, sourceLabel) {
+            try {
+                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
+                const selectedSheetName = sheetName && workbook.SheetNames.includes(sheetName)
+                    ? sheetName
+                    : workbook.SheetNames[0];
+                if (sheetName && selectedSheetName !== sheetName) {
+                    setStatus(`List "${sheetName}" nenalezen. Byl použit první list (${selectedSheetName}).`);
+                }
+                const sheet = workbook.Sheets[selectedSheetName];
+                const json = XLSX.utils.sheet_to_json(sheet, { defval: null });
+                state.data = json
+                    .map(normalizeRow)
+                    .filter(item => item.date && !Number.isNaN(item.date.getTime()));
+                state.meta.source = sourceLabel || 'Neznámý zdroj';
+                populateFilters();
+                applyFilters();
+                if (!state.data.length) {
+                    setStatus('Soubor byl načten, ale nepodařilo se rozpoznat žádná data. Zkontrolujte názvy sloupců.');
+                }
+            } catch (error) {
+                console.error('Chyba při zpracování Excelu:', error);
+                setStatus('Nepodařilo se zpracovat strukturu Excelového souboru.');
+            }
+        }
+
+        function normalizeRow(row) {
+            const normalized = {};
+            for (const [key, aliases] of Object.entries(columnMap)) {
+                const foundKey = Object.keys(row).find(col => aliases.includes(col.toString().trim().toLowerCase()));
+                normalized[key] = foundKey ? row[foundKey] : null;
+            }
+
+            const parseNumber = value => {
+                if (typeof value === 'number') return value;
+                if (typeof value === 'string') {
+                    const cleaned = value.replace(/[^0-9,.-]/g, '').replace(',', '.');
+                    return cleaned ? Number(cleaned) : 0;
+                }
+                return 0;
+            };
+
+            const parseDate = value => {
+                if (value instanceof Date) return value;
+                if (typeof value === 'number') {
+                    const parsed = XLSX.SSF.parse_date_code(value, { date1904: false });
+                    if (parsed) {
+                        return new Date(parsed.y, parsed.m - 1, parsed.d);
+                    }
+                }
+                if (typeof value === 'string') {
+                    let parsed = luxon.DateTime.fromISO(value);
+                    if (!parsed.isValid) parsed = luxon.DateTime.fromFormat(value, 'd.M.yyyy');
+                    if (!parsed.isValid) parsed = luxon.DateTime.fromFormat(value, 'd.M.yy');
+                    if (!parsed.isValid) parsed = luxon.DateTime.fromFormat(value, 'M/d/yyyy');
+                    if (parsed.isValid) {
+                        return parsed.toJSDate();
+                    }
+                }
+                return null;
+            };
+
+            const excelDate = normalized.date;
+            let parsedDate = parseDate(excelDate);
+            if (!parsedDate && typeof excelDate === 'object' && excelDate !== null) {
+                const values = Object.values(excelDate).join('-');
+                parsedDate = parseDate(values);
+            }
+
+            return {
+                date: parsedDate,
+                channel: normalized.channel ? normalized.channel.toString().trim() : 'Neznámé',
+                campaign: normalized.campaign ? normalized.campaign.toString().trim() : 'Neurčeno',
+                spend: parseNumber(normalized.spend),
+                revenue: parseNumber(normalized.revenue),
+                leads: parseNumber(normalized.leads),
+                conversions: parseNumber(normalized.conversions),
+                clicks: parseNumber(normalized.clicks),
+                impressions: parseNumber(normalized.impressions)
+            };
+        }
+
+        function populateFilters() {
+            const channelFilter = document.getElementById('channelFilter');
+            const campaignFilter = document.getElementById('campaignFilter');
+            const uniqueChannels = ['ALL', ...new Set(state.data.map(item => item.channel).filter(Boolean))];
+            const uniqueCampaigns = ['ALL', ...new Set(state.data.map(item => item.campaign).filter(Boolean))];
+
+            channelFilter.innerHTML = uniqueChannels.map(value => `<option value="${value}">${value === 'ALL' ? 'Všechny kanály' : value}</option>`).join('');
+            campaignFilter.innerHTML = uniqueCampaigns.map(value => `<option value="${value}">${value === 'ALL' ? 'Všechny kampaně' : value}</option>`).join('');
+        }
+
+        function applyFilters() {
+            const fromDate = document.getElementById('fromDate').value ? new Date(document.getElementById('fromDate').value) : null;
+            const toDate = document.getElementById('toDate').value ? new Date(document.getElementById('toDate').value) : null;
+            const channel = document.getElementById('channelFilter').value;
+            const campaign = document.getElementById('campaignFilter').value;
+
+            state.filtered = state.data.filter(item => {
+                const matchDate = (!fromDate || item.date >= fromDate) && (!toDate || item.date <= toDate);
+                const matchChannel = channel === 'ALL' || item.channel === channel;
+                const matchCampaign = campaign === 'ALL' || item.campaign === campaign;
+                return matchDate && matchChannel && matchCampaign;
+            });
+
+            updateKPIs();
+            updateCharts();
+            updateTable();
+        }
+
+        function updateKPIs() {
+            const totals = state.filtered.reduce((acc, item) => {
+                acc.spend += item.spend;
+                acc.revenue += item.revenue;
+                acc.leads += item.leads;
+                acc.conversions += item.conversions;
+                acc.clicks += item.clicks;
+                acc.impressions += item.impressions;
+                return acc;
+            }, { spend: 0, revenue: 0, leads: 0, conversions: 0, clicks: 0, impressions: 0 });
+
+            const roi = totals.spend ? ((totals.revenue - totals.spend) / totals.spend) : 0;
+            const cpl = totals.leads ? totals.spend / totals.leads : 0;
+            const cpa = totals.conversions ? totals.spend / totals.conversions : 0;
+            const ctr = totals.impressions ? totals.clicks / totals.impressions : 0;
+            const convRate = totals.clicks ? totals.conversions / totals.clicks : 0;
+
+            const kpis = [
+                { label: 'Náklady', value: formatters.currency.format(totals.spend) },
+                { label: 'Tržby', value: formatters.currency.format(totals.revenue) },
+                { label: 'ROI', value: formatters.percent.format(roi) },
+                { label: 'Cost per Lead', value: totals.leads ? formatters.currency.format(cpl) : 'N/A' },
+                { label: 'Cost per Acquisition', value: totals.conversions ? formatters.currency.format(cpa) : 'N/A' },
+                { label: 'Konverzní poměr', value: formatters.percent.format(convRate) },
+                { label: 'CTR', value: totals.impressions ? formatters.percent.format(ctr) : 'N/A' }
+            ];
+
+            const kpiGrid = document.getElementById('kpiGrid');
+            kpiGrid.innerHTML = kpis.map(kpi => `
+                <article class="kpi-card">
+                    <h3>${kpi.label}</h3>
+                    <div class="value">${kpi.value}</div>
+                    <div class="delta">Zdroj: ${state.meta.source}</div>
+                </article>
+            `).join('');
+        }
+
+        function updateCharts() {
+            if (!state.filtered.length) {
+                Object.values(state.charts).forEach(chart => chart?.destroy());
+                state.charts = {};
+                return;
+            }
+
+            const groupedByDate = groupBy(state.filtered, item => item.date.toISOString().split('T')[0]);
+            const trendLabels = Object.keys(groupedByDate).sort();
+            const trendData = trendLabels.map(label => groupedByDate[label].reduce((acc, item) => {
+                acc.spend += item.spend;
+                acc.revenue += item.revenue;
+                acc.conversions += item.conversions;
+                return acc;
+            }, { spend: 0, revenue: 0, conversions: 0 }));
+
+            const channelGroups = groupBy(state.filtered, item => item.channel);
+            const channelLabels = Object.keys(channelGroups);
+            const channelDataset = channelLabels.map(label => channelGroups[label].reduce((acc, item) => {
+                acc.spend += item.spend;
+                acc.conversions += item.conversions;
+                acc.revenue += item.revenue;
+                return acc;
+            }, { spend: 0, conversions: 0, revenue: 0 }));
+
+            const funnelTotals = state.filtered.reduce((acc, item) => {
+                acc.impressions += item.impressions;
+                acc.clicks += item.clicks;
+                acc.leads += item.leads;
+                acc.conversions += item.conversions;
+                return acc;
+            }, { impressions: 0, clicks: 0, leads: 0, conversions: 0 });
+
+            renderTrendChart(trendLabels, trendData);
+            renderChannelChart(channelLabels, channelDataset);
+            renderFunnelChart(funnelTotals);
+        }
+
+        function renderTrendChart(labels, data) {
+            const ctx = document.getElementById('trendChart');
+            state.charts.trend?.destroy();
+            state.charts.trend = new Chart(ctx, {
+                type: 'line',
+                data: {
+                    labels,
+                    datasets: [
+                        {
+                            label: 'Náklady',
+                            data: data.map(item => item.spend),
+                            borderColor: '#2563eb',
+                            backgroundColor: 'rgba(37, 99, 235, 0.25)',
+                            tension: 0.35,
+                            fill: true
+                        },
+                        {
+                            label: 'Tržby',
+                            data: data.map(item => item.revenue),
+                            borderColor: '#16a34a',
+                            backgroundColor: 'rgba(22, 163, 74, 0.2)',
+                            tension: 0.35,
+                            fill: true
+                        },
+                        {
+                            label: 'Konverze',
+                            data: data.map(item => item.conversions),
+                            borderColor: '#f97316',
+                            backgroundColor: 'rgba(249, 115, 22, 0.18)',
+                            tension: 0.35,
+                            yAxisID: 'y1'
+                        }
+                    ]
+                },
+                options: {
+                    responsive: true,
+                    maintainAspectRatio: false,
+                    interaction: { mode: 'index', intersect: false },
+                    scales: {
+                        x: { ticks: { maxRotation: 0 } },
+                        y: {
+                            title: { display: true, text: 'CZK' },
+                            beginAtZero: true
+                        },
+                        y1: {
+                            position: 'right',
+                            title: { display: true, text: 'Počet konverzí' },
+                            beginAtZero: true,
+                            grid: { drawOnChartArea: false }
+                        }
+                    },
+                    plugins: {
+                        legend: { position: 'top' },
+                        tooltip: {
+                            callbacks: {
+                                label: context => {
+                                    const { dataset, raw } = context;
+                                    if (dataset.label === 'Konverze') {
+                                        return `${dataset.label}: ${formatters.integer.format(raw)}`;
+                                    }
+                                    return `${dataset.label}: ${formatters.currency.format(raw)}`;
+                                }
+                            }
+                        }
+                    }
+                }
+            });
+        }
+
+        function renderChannelChart(labels, dataset) {
+            const ctx = document.getElementById('channelChart');
+            state.charts.channel?.destroy();
+            state.charts.channel = new Chart(ctx, {
+                type: 'bar',
+                data: {
+                    labels,
+                    datasets: [
+                        {
+                            label: 'Tržby',
+                            data: dataset.map(item => item.revenue),
+                            backgroundColor: '#16a34a'
+                        },
+                        {
+                            label: 'Náklady',
+                            data: dataset.map(item => item.spend),
+                            backgroundColor: '#2563eb'
+                        },
+                        {
+                            label: 'Konverze',
+                            data: dataset.map(item => item.conversions),
+                            backgroundColor: '#f97316',
+                            yAxisID: 'y1'
+                        }
+                    ]
+                },
+                options: {
+                    responsive: true,
+                    maintainAspectRatio: false,
+                    scales: {
+                        y: {
+                            beginAtZero: true,
+                            stacked: false,
+                            title: { display: true, text: 'CZK' }
+                        },
+                        y1: {
+                            position: 'right',
+                            beginAtZero: true,
+                            grid: { drawOnChartArea: false },
+                            title: { display: true, text: 'Konverze' }
+                        }
+                    },
+                    plugins: {
+                        legend: { position: 'bottom' },
+                        tooltip: {
+                            callbacks: {
+                                label: context => {
+                                    if (context.dataset.label === 'Konverze') {
+                                        return `${context.dataset.label}: ${formatters.integer.format(context.raw)}`;
+                                    }
+                                    return `${context.dataset.label}: ${formatters.currency.format(context.raw)}`;
+                                }
+                            }
+                        }
+                    }
+                }
+            });
+        }
+
+        function renderFunnelChart(totals) {
+            const ctx = document.getElementById('funnelChart');
+            state.charts.funnel?.destroy();
+            const values = [totals.impressions, totals.clicks, totals.leads, totals.conversions];
+            const labels = ['Zobrazení', 'Prokliky', 'Leady', 'Konverze'];
+            state.charts.funnel = new Chart(ctx, {
+                type: 'doughnut',
+                data: {
+                    labels,
+                    datasets: [{
+                        data: values,
+                        backgroundColor: ['#64748b', '#2563eb', '#f59e0b', '#16a34a']
+                    }]
+                },
+                options: {
+                    responsive: true,
+                    maintainAspectRatio: false,
+                    plugins: {
+                        legend: { position: 'bottom' },
+                        tooltip: {
+                            callbacks: {
+                                label: context => `${context.label}: ${formatters.integer.format(context.raw)}`
+                            }
+                        }
+                    }
+                }
+            });
+        }
+
+        function updateTable() {
+            const grouped = groupBy(state.filtered, item => `${item.campaign}|||${item.channel}`);
+            const campaigns = Object.entries(grouped).map(([key, items]) => {
+                const [campaign, channel] = key.split('|||');
+                const totals = items.reduce((acc, item) => {
+                    acc.spend += item.spend;
+                    acc.revenue += item.revenue;
+                    acc.conversions += item.conversions;
+                    return acc;
+                }, { spend: 0, revenue: 0, conversions: 0 });
+                const roi = totals.spend ? (totals.revenue - totals.spend) / totals.spend : 0;
+                return { campaign, channel, ...totals, roi };
+            }).sort((a, b) => b.roi - a.roi).slice(0, 15);
+
+            const tbody = document.getElementById('campaignTable');
+            if (!campaigns.length) {
+                tbody.innerHTML = '<tr><td colspan="6">Žádná data pro zvolené filtry.</td></tr>';
+                return;
+            }
+
+            tbody.innerHTML = campaigns.map(row => `
+                <tr>
+                    <td>${row.campaign}</td>
+                    <td>${row.channel}</td>
+                    <td>${formatters.currency.format(row.revenue)}</td>
+                    <td>${formatters.currency.format(row.spend)}</td>
+                    <td>${formatters.percent.format(row.roi)}</td>
+                    <td>${formatters.integer.format(row.conversions)}</td>
+                </tr>
+            `).join('');
+        }
+
+        function groupBy(array, getKey) {
+            return array.reduce((acc, item) => {
+                const key = getKey(item);
+                if (!acc[key]) acc[key] = [];
+                acc[key].push(item);
+                return acc;
+            }, {});
+        }
 
-    <footer>
-        <p>© 2025 Alpská cesta – plán zájezdu do Rakouska</p>
-    </footer>
+        function setStatus(message) {
+            statusMessage.textContent = message;
+        }
+    </script>
 </body>
-</html>
\ No newline at end of file
+</html>
